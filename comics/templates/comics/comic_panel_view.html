{% extends "base.html" %}
{% block main_content %}

{% load static %}

<!-- must follow this link here: 
https://stackoverflow.com/questions/38482059/enabling-cors-cross-origin-request-in-django
-->

<!-- Bootstrap core CSS -->
<link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'css/blog-post.css' %}" rel="stylesheet">


  <!-- Page Content -->
  <div class="container">

    <div class="row">

      <div class = "col-sm"></div>

      <!-- Post Content Column -->
      <div class="col-sm-8">

        {% if comic_panel %}
          <!-- Title -->
          <div class="mt-4 engirls_font_large">
            <h1>{{ comic_panel.title }}</h1> <p class = "engirls_font_norm">{{ comic_panel.uploadTime }}</p>
          </div>

          <hr>

          <!-- Preview Image -->
        <div class="shadow">
          <img class="rounded img-fluid" src="{{ MEDIA_URL }}{{ comic_panel.image }}" alt="{{ comic_panel.caption }}">
        </div>
        <hr>  

             <div class = "container">
                <div class = "row">
                   <!-- Button to oldest comic -->
                   {% if oldest_comic_pk != comic_panel.pk %}
                      <div class = "col-3 engirls_font_norm">
                        <a href="{% url 'view_panel' comic_pk=oldest_comic_pk %}" role="button" class="btn btn-outline-dark btn-sm"> << First </a>
                      </div>
                      {% if prev_comic_pk != -1 %}
                        <div class = "col-3 engirls_font_norm">
                          <a href="{% url 'view_panel' comic_pk=prev_comic_pk %}" role="button" class="btn btn-outline-dark btn-sm"> < Prev </a>
                        </div>
                      {% endif%}
                   {% endif %}
                  <!-- Button to previous comic -->
                  {% if newest_comic_pk != comic_panel.pk %}
                      {%  if next_comic_pk != -1%}
                        <div class = "col-3 engirls_font_norm">
                          <a href="{% url 'view_panel' comic_pk=next_comic_pk %}" role="button" class="btn btn-outline-dark btn-sm"> Next > </a>
                        </div>
                      {% endif %}
                      <div class = "col-3 engirls_font_norm">
                        <a href="{% url 'view_panel' comic_pk=newest_comic_pk %}" role="button" class="btn btn-outline-dark btn-sm"> Newest >> </a>
                      </div> 
                  {% endif %}
                  <!-- row --> 
                  </div>            
               
                <!-- Container -->
                </div>
              <hr>                  

        <div class="card my-4">
           <!-- Description -->

          <div class="card-body">
              {{ comic_panel.description | safe }} 
          </div>

          <!-- card -->
          </div>

      {% else %}
        <div class = "col"></div>
        <div class = "my-4 text-center">
          <p class = "lead engirls_font_large"> Looks like you don't have any comics! Upload some? </p>
        </div>

      {% endif %}
      <!-- col-sm -->
      </div> 


      <!-- 3rd column - Comments -->
      <div class = col-sm>
        <div class = "comment_form">
          {% if True%}
         
          <form action = "" method="POST"> 
              {% csrf_token %}
              {{ comment_form }}
          <button id="post_comment" type="submit" class="button-submit">post</button>
          </form>
          {% else %}
            <div class="engirls_font_norm"> Please log in to comment :) </p>
          {% endif %}
          </div>
          <div id = "comment_list"></div>
          <a name="comment_start"></a>
        </div>       
      </div>

    </div>
    <!-- /.row -->
   
  </div>
  <!-- /.container -->
<script>

// Render the list of comments via ajax
function render_comment_list(){
  $("#comment_list").load('comics/comments/{{ comic_panel.pk }}/1/');
}

// Post and render the comment list upon clickin the post comment button
$("#post_comment").on('click', function(e) {
    e.preventDefault();
    var form = $(this).closest("form");
     $.ajax({
            url: 'comics/comments/{{ comic_panel.pk }}/1/',
            type: 'POST',
            data: form.serialize(),
            dataType: "jsonp"
        }).done(function(data) {
          render_comment_list();
        });
      return false;
  });

$(document).ready(function(){
  render_comment_list();
});


 
</script>
<!-- Bootstrap core JavaScript -->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>



{% endblock %}